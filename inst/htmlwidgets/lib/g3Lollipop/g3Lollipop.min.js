!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.g3=t.g3||{},t.d3)}(this,function(t,e){"use strict";function n(t,e){var n=(document.getElementById("canvas")||document.createElement("canvas")).getContext("2d");return n.font=e,n.measureText(t).width}function r(t,e){return t=t||1e5,e=e||1e6-1,Math.floor(Math.random()*(e-t)+t)}e=e&&e.hasOwnProperty("default")?e.default:e;var a={bottlerocket1:["#A42820","#5F5647","#9B110E","#3F5151","#4E2A1E","#550307","#0C1707"],bottlerocket2:["#FAD510","#CB2314","#273046","#354823","#1E1E1E"],rushmore1:["#E1BD6D","#F2300F","#35274A","#EABE94","#0B775E"],royal1:["#899DA4","#C93312","#FAEFD1","#DC863B"],royal2:["#9A8822","#F5CDB4","#F8AFA8","#FDDDA0","#74A089"],zissou1:["#3B9AB2","#78B7C5","#EBCC2A","#E1AF00","#F21A00"],darjeeling1:["#FF0000","#00A08A","#F2AD00","#F98400","#5BBCD6"],darjeeling2:["#ECCBAE","#046C9A","#D69C4E","#ABDDDE","#000000"],chevalier1:["#446455","#FDD262","#D3DDDC","#C7B19C"],fantasticfox1:["#DD8D29","#E2D200","#46ACC8","#E58601","#B40F20"],moonrise1:["#F3DF6C","#CEAB07","#D5D5D3","#24281A"],moonrise2:["#798E87","#C27D38","#CCC591","#29211F"],moonrise3:["#85D4E3","#F4B5BD","#9C964A","#CDC08C","#FAD77B"],cavalcanti1:["#D8B70A","#02401B","#A2A475","#81A88D","#972D15"],grandbudapest1:["#F1BB7B","#FD6467","#5B1A18","#D67236"],grandbudapest2:["#E6A0C4","#C6CDF7","#D8A499","#7294D4"],google16:["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"],google5:["#008744","#0057e7","#d62d20","#ffa700","#ffffff"],material1:["#263238","#212121","#3e2723","#dd2c00","#ff6d00","#ffab00","#ffd600","#aeea00","#64dd17","#00c853","#00bfa5","#00b8d4","#0091ea","#2962ff","#304ffe","#6200ea","#aa00ff","#c51162","#d50000"],pie1:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],pie2:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],pie3:["#495769","#A0C2BB","#F4A775","#F4C667","#F37361"],pie4:["#FA7921","#E55934","#9BC53D","#FDE74C","#5BC0EB"],pie5:["#5DA5DA","#4D4D4D","#60BD68","#B2912F","#B276B2","#F15854","#FAA43A"],pie6:["#537ea2","#42a593","#9f1a1a","#7c5f95","#61a070"],pie7:["#bddff9","#1e72bf","#ead1ab","#a2dbc5","#c7ae7d"],breakfast:["#b6411a","#eec3d8","#4182dd","#ecf0c8","#2d6328"],set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],category10:["#1f77b4","#2ca02c","#d62728","#ff7f0e","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#bf5b17","#386cb0","#f0027f","#666666"],dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]};function o(){return a.google16}function i(t){return t in a?a[t]:o}function l(t){return e.scaleOrdinal(i(t))}var s=s||function(t){if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in r,o=/constructor/i.test(t.HTMLElement)||t.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent),l=t.setImmediate||t.setTimeout,s=function(t){l(function(){throw t},0)},c=function(t){setTimeout(function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()},4e4)},u=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},p=function(e,p,d){d||(e=u(e));var f,m=this,g="application/octet-stream"===e.type,h=function(){!function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var a=t["on"+e[r]];if("function"==typeof a)try{a.call(t,n||t)}catch(t){s(t)}}}(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,a)return f=n().createObjectURL(e),void l(function(){var t,e;r.href=f,r.download=p,t=r,e=new MouseEvent("click"),t.dispatchEvent(e),h(),c(f),m.readyState=m.DONE},0);!function(){if((i||g&&o)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=i?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,m.readyState=m.DONE,h()},r.readAsDataURL(e),void(m.readyState=m.INIT)}f||(f=n().createObjectURL(e)),g?t.location.href=f:t.open(f,"_blank")||(t.location.href=f);m.readyState=m.DONE,h(),c(f)}()},d=p.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=u(t)),navigator.msSaveOrOpenBlob(t,e)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(t,e,n){return new p(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0);function c(t,r,a){var o=!0,i={left:10,right:0,top:5,bottom:5},l=e.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout");r=r||!1,a=a||[];var s,c=0,u="normal 12px sans-serif",p="black",d="bold 12px sans-serif",f="black";return{set target(e){t=e},get target(){return t},set title(t){r=t},get title(){return r},set series(t){a=t},get series(){return a},set margin(t){i=t},get margin(){return i},set dispatch(t){l=t},get dispatch(){return l},set interactive(t){o=t},get interactive(){return o},set labelFont(t){u=t},get labelFont(){return u},set labelColor(t){p=t},get labelColor(){return p},set titleFont(t){d=t},get titleFont(){return d},set titleColor(t){f=t},get titleColor(){return f},get height(){return c},addSeries:function(t){t.key in Object.keys(a)||a.push(t)},getLegendStatus:function(){return a.map(function(t){return{key:t.key,status:t._status||!0}})},destroy:function(){s.select(".g3-legend").selectAll("*").remove()},draw:function(){a.forEach(t=>t._status=!0);let m=+(s=e.select("#"+t)).attr("width"),g=+s.attr("height"),h=m-(i.left||0)-(i.right||0),b=s.append("g").attr("class","g3-legend").attr("transform","translate("+i.left+","+(g+i.top)+")"),y=r?n(r,d):0,x=Math.min(y+6,1/3*h),v=h-x,C={x:0,y:8},w={x:0,y:8};r&&b.append("g").attr("class","g3-legend-title").append("text").attr("x",x-6).attr("y",8).attr("text-anchor","end").attr("fill",f).style("font",d).attr("dy","0.35em").text(r);b.append("g").attr("class","g3-legend-item-container").attr("transform","translate("+x+", 0)").selectAll(".g3-legend-item").data(a).enter().append("g").attr("class","g3 g3-legend-item").style("cursor",o?"pointer":"default").each(function(t){let r=e.select(this),a=t.value.label||t.key;var i;i=n(a,u),(i+=23)>v-w.x?(C.x=0,C.y=w.y+16,w.x=i,w.y=C.y):(C.x=w.x,w.x+=i);let s=C.x+12+3,c=C.y;r.attr("state","enabled").attr("defaultColor",t.value.fill),r.append("circle").attr("cx",s).attr("cy",c).attr("r",3).attr("fill",t.value.fill||"transparent").attr("stroke-width",1).attr("stroke","grey"),s+=8,r.append("text").attr("x",s).attr("y",c).attr("text-anchor","start").attr("fill",p).style("font",u).attr("dy","0.35em").text(a),r.on("click",function(){var e,n,a,i;o&&(n=(e=r).attr("defaultColor"),a=e.select("circle"),i=e.select("text"),"enabled"==e.attr("state")?(e.attr("state","disabled"),a.attr("fill","transparent").attr("stroke",n),i.style("opacity",.5)):(e.attr("state","enabled"),a.attr("fill",n).attr("stroke","grey"),i.style("opacity",1)),l.call("legendClick",this,t.key,"enabled"==r.attr("state")),t._status="enabled"==r.attr("state"))})}),c=i.top+C.y+8+i.bottom,s.attr("height",c+g)}}}function u(){var t=function(){return"n"},n=function(){return[0,0]},r=function(){return" "},a=document.body,o=d(),i=null,l=null,s=null;function c(t){(i=function(t){var e=t.node();if(!e)return null;if("svg"===e.tagName.toLowerCase())return e;return e.ownerSVGElement}(t))&&(l=i.createSVGPoint(),a.appendChild(o))}c.show=function(){var e=Array.prototype.slice.call(arguments);e[e.length-1]instanceof SVGElement&&(s=e.pop());var o,i=r.apply(this,e),l=n.apply(this,e),d=t.apply(this,e),m=f(),g=p.length,h=document.documentElement.scrollTop||a.scrollTop,b=document.documentElement.scrollLeft||a.scrollLeft;for(m.html(i).style("opacity",1).style("pointer-events","all");g--;)m.classed(p[g],!1);return o=u.get(d).apply(this),m.classed(d,!0).style("top",o.top+l[0]+h+"px").style("left",o.left+l[1]+b+"px"),c},c.hide=function(){return f().style("opacity",0).style("pointer-events","none"),c},c.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return f().attr(t);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.attr.apply(f(),r),c},c.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return f().style(t);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.style.apply(f(),r),c},c.direction=function(e){return arguments.length?(t=null==e?e:g(e),c):t},c.offset=function(t){return arguments.length?(n=null==t?t:g(t),c):n},c.html=function(t){return arguments.length?(r=null==t?t:g(t),c):r},c.rootElement=function(t){return arguments.length?(a=null==t?t:g(t),c):a},c.destroy=function(){return o&&(f().remove(),o=null),c};var u=e.map({n:function(){var t=m(this);return{top:t.n.y-o.offsetHeight,left:t.n.x-o.offsetWidth/2}},s:function(){var t=m(this);return{top:t.s.y,left:t.s.x-o.offsetWidth/2}},e:function(){var t=m(this);return{top:t.e.y-o.offsetHeight/2,left:t.e.x}},w:function(){var t=m(this);return{top:t.w.y-o.offsetHeight/2,left:t.w.x-o.offsetWidth}},nw:function(){var t=m(this);return{top:t.nw.y-o.offsetHeight,left:t.nw.x-o.offsetWidth}},ne:function(){var t=m(this);return{top:t.ne.y-o.offsetHeight,left:t.ne.x}},sw:function(){var t=m(this);return{top:t.sw.y,left:t.sw.x-o.offsetWidth}},se:function(){var t=m(this);return{top:t.se.y,left:t.se.x}}}),p=u.keys();function d(){var t=e.select(document.createElement("div"));return t.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t.node()}function f(){return null==o&&(o=d(),a.appendChild(o)),e.select(o)}function m(t){for(var n=s||e.event.target;null==n.getScreenCTM&&null!=n.parentNode;)n=n.parentNode;var r={},a=n.getScreenCTM(),o=n.getBBox(),i=o.width,c=o.height,u=o.x,p=o.y;return l.x=u,l.y=p,r.nw=l.matrixTransform(a),l.x+=i,r.ne=l.matrixTransform(a),l.y+=c,r.se=l.matrixTransform(a),l.x-=i,r.sw=l.matrixTransform(a),l.y-=c/2,r.w=l.matrixTransform(a),l.x+=i,r.e=l.matrixTransform(a),l.x-=i/2,l.y-=c/2,r.n=l.matrixTransform(a),l.y+=c,r.s=l.matrixTransform(a),r}function g(t){return"function"==typeof t?t:function(){return t}}return c}t.getTextWidth=n,t.getUniqueID=r,t.palettes=a,t.defaultPalette=o,t.getPalette=i,t.listPalettes=function(){return Object.keys(a)},t.scaleOrdinal=l,t.output=function(){function t(t,e){return(t=t||n)+"."+e}function e(t){t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),function(t,e){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=t;var r=e.hasChildNodes()?e.children[0]:null;e.insertBefore(n,r)}(function(t){var e=[];e.push("#"+t.id);for(let n=0;n<t.classList.length;n++)c("."+t.classList[n],e)||e.push("."+t.classList[n]);var n=t.getElementsByTagName("*");for(let t=0;t<n.length;t++){var r=n[t].id;c("#"+r,e)||e.push("#"+r);var a=n[t].classList;for(let t=0;t<a.length;t++)c("."+a[t],e)||e.push("."+a[t])}var o="";for(let t=0;t<document.styleSheets.length;t++){var i=document.styleSheets[t];try{if(!i.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var l=i.cssRules,s=0;s<l.length;s++)c(l[s].selectorText,e)&&(o+=l[s].cssText)}return o;function c(t,e){return-1!==e.indexOf(t)}}(t),t);var e=(new XMLSerializer).serializeToString(t);return e=(e=e.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}var n="output",r="svg";function a(t){r=t||r}return a.toSVG=function(n){n=t(n,"svg");var a=e(document.querySelector(r)),o=new Blob([a],{type:"image/svg+xml"});s(o,n)},a.toPNG=function(n){n=t(n,"png");var a=document.querySelector(r),o=+a.getAttribute("width"),i=+a.getAttribute("height"),l=e(a),c="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l))),u=document.createElement("canvas");u.width=o,u.height=i;var p=u.getContext("2d"),d=new Image;d.src=c,d.onload=function(){p.clearRect(0,0,o,i),p.drawImage(d,0,0,o,i),u.toBlob(function(t){s(t,n)})}},a},t.legend=c,t.tooltip=u,t.Lollipop=function(t,a,o){const i="g3_lollipop",s={circle:0,pie:1},p={x:"AA_Position",y:"Protein_Change",factor:"Mutation_Class"},d={symbol:"hgnc_symbol",name:"protein_name",length:"length",domainType:"pfam",details:{start:"pfam_start",end:"pfam_end",ac:"pfam_ac",name:"pfam_id"}};o=o||800,(a=a||"circle")in s||(a="circle");var f,m,g,h,b,y,x,v,C,w,k,S,T,L,A,D,_,E,N,B,F,M,P,z,I,O,R,H,W,j,U,V,$,q,G,Y=r(),X={chartID:i+"_chart_"+Y,className:"g3-chart",tooltip:!0,margin:{left:40,right:20,top:15,bottom:25},background:"transparent",transitionTime:600,legend:!0,legendOpt:{margin:{},interactive:!0,title:"__undefined__"}},Q={id:i+"-main-"+Y,defsId:i+"-main-defs-"+Y,xAxisDefsId:i+"-xAxis-defs-"+Y,height:420,background:"rgb(244,244,244)",lollipopClassName:{group:"lollipop",line:"lollipopLine",pop:"pop"},lollipopLine:{stroke:"rgb(42,42,42)","stroke-width":.5},popClassName:{pie:"popPie",slice:"pieSlice",text:"popText",circle:"popCircle",label:"popLabel"},popCircle:{stroke:"wheat","stroke-width":.5},popText:{fill:"#EEE","font-family":"Sans","font-weight":"normal","text-anchor":"middle",dy:"0.35em"},popLabel:{"font-family":"Arial","font-weight":"normal",minFontSize:10,fontsizeToRadius:1.4,padding:5},popColorSchemeName:"accent",popColorScheme:l("accent"),yPaddingRatio:1.1,popParams:{rMin:2,rMax:12,addNumRCutoff:8,yLowerQuantile:.25,yUpperQuantile:.99},title:{id:"g3-chart-title",text:"",font:"normal 16px Arial",color:"#424242",alignment:"middle",dy:"0.35em"},axisLabel:{font:"normal 12px Arial",fill:"#4f4f4f","text-anchor":"middle",dy:"-2em",alignment:"middle"},ylab:{text:"mutations"}},J={id:i+"-domain-"+Y,defsId:i+"-annotation-defs-"+Y,height:30,margin:{top:4,bottom:0},background:"transparent",className:{track:"domain_track",bar:"domain_bar",domain:i+"_domain",brush:"domain-x-brush",zoom:"main-viz-zoom"},domain:{colorSchemeName:"category10",colorScheme:l("category10"),margin:{top:0,bottom:0},label:{font:"normal 11px Arial",color:"#f2f2f2"}},bar:{background:"#e5e3e1",margin:{top:2,bottom:2}},brush:!0,zoom:!0},K=[],Z={},tt=!1,et=[],nt=null,rt=!1,at=!1,ot={},it=function(t){return st(t)-lt(t)},lt=function(t){return D(t[m.details.start])},st=function(t){return D(t[m.details.end])},ct=function(){D.domain(A),N.call(_),S.attr("x",function(t){return lt(t)}).attr("width",function(t){return it(t)}),T.attr("x",function(t){return(lt(t)+st(t))/2}),v.attr("x1",function(t){return pt(t)}).attr("x2",function(t){return pt(t)}),C.attr("transform",function(t){return"translate("+pt(t)+","+dt(t)+")"})},ut=function(){if(e.event.sourceEvent&&"zoom"===e.event.sourceEvent.type)return;let t=e.event.selection||R.range();A=t.map(R.invert),J.zoom&&b.select(".main-viz-zoom").call(H.transform,e.zoomIdentity.scale($/(t[1]-t[0])).translate(-t[0],0)),ct()},pt=function(t){return D(t.position)},dt=function(t){return F(t._currentState.count)},ft=function(t){let e=t._currentState.count;return 0==e?0:e>=w?Q.popParams.rMax:e<=k?Q.popParams.rMin:(e-k)/(w-k)*(Q.popParams.rMax-Q.popParams.rMin)+Q.popParams.rMin},mt=function(t){let n="";return at?(n+=`<div class="note">\n            <table class="pure-table pure-table-bordered">\n                <caption> Position ${t.position} </caption>\n                <thead>\n                    <tr>\n                        <th scope="col">Class</th>\n                        <th scope="col">#</th>\n                        <th scope="col">Change</th>\n                        <th scope="col">&#37;</th>\n                    </tr>\n                </thead>\n                <tbody>`,t._currentState.summary.forEach(function(r){r.value.count>0&&(n+=`\n                    <tr>\n                        <th scope="row"> ${r.key} </th>\n                        <td> ${r.value.count} </td>\n                        <td>`+gt(r.value.byY)+"</td>\n                        <td>"+e.format(".1f")(r.value.count/t._currentState.count*100)+"&#37;</td>\n                    </tr>")}),n+="\n                </tbody>\n            </table></div>"):(n+=`\n            <table class="pure-table pure-table-bordered">\n                <caption> Position ${t.position} </caption>\n                <thead>\n                    <tr>\n                        <th scope="col">Change</th>\n                        <th scope="col">&#37;</th>\n                    </tr>\n                </thead>\n                <tbody>`,t._currentState.summary[0].value.byY.forEach(function(r){n+=`\n                    <tr>\n                        <th> ${r.key} </th>\n                        <td>`+e.format(".1f")(r.value/t._currentState.count*100)+"&#37;</td>\n                    </tr>"}),n+="\n                </tbody>\n            </table>"),n},gt=function(t){var e="";return t.forEach(function(t){e+=`${t.key} (n=${t.value})<br>`}),e},ht=function(t,e){X.tooltip&&nt.show(t,e)},bt=function(t){X.tooltip&&nt.hide(t)},yt=function(t){let e,n,r,a=-1;return t._currentState.summary.forEach(function(t){t.value.count>0&&t.value.count>a&&(e=t.value.byY[0].key,r=t,n=Q.popColorScheme(t.key),a=t.value.count)}),{class:r,entry:e,count:a,color:n}},xt=function(t,e){if(t._currentState.showLabel){t._currentState.showLabel=!1;let n=e.select("."+Q.popClassName.label);Nt(n.attr("yMaxValue"),-1),n.transition().duration(X.transitionTime).attr("transform","rotate(0)").remove()}else{t._currentState.showLabel=!0;let r=yt(t),a=Math.max(t._currentState.radius*Q.popLabel.fontsizeToRadius,Q.popLabel.minFontSize)+"px",o=Q.popLabel["font-weight"]+" "+a+" "+Q.popLabel["font-family"],i=n(r.entry,o),l=t._currentState.radius+Q.popLabel.padding+i,s=(B[1]-B[0])*(l/V),c=t._currentState.count+s;Nt(c,1),e.append("text").classed(Q.popClassName.label,!0).attr("x",-t._currentState.radius-Q.popLabel.padding).attr("y",0).attr("yMaxValue",c).text(r.entry).style("fill",r.color).style("font",o).attr("dy",".35em").attr("text-anchor","end").transition().duration(X.transitionTime).attr("transform","rotate(90)")}},vt=function(){return e.pie().sort(null)},Ct=function(t){let n=e.select(this);t._currentState.showLabel&&(n.select("."+Q.popClassName.label).remove(),t._currentState.showLabel=!1);let r=t._currentState.radius=ft(t);switch(a){case"pie":!function(t,n,r){let a=e.arc().innerRadius(0).outerRadius(r),o=vt().value(function(t){return t.value.count}),i=n.select("."+Q.popClassName.pie).selectAll("path."+Q.popClassName.slice).data(o(t._currentState.summary));i.enter().insert("path"),i.transition().duration(X.transitionTime).attrTween("d",function(t){this._current=this._current||t;let n=e.interpolate(this._current,t);return this._current=n(0),function(t){return a(n(t))}}),i.exit().remove()}(t,n,r);break;default:!function(t,e,n){let r=e.select("."+Q.popClassName.circle),a=yt(t).color||"transparent";r.transition().duration(X.transitionTime).attr("r",n).attr("fill",a)}(t,n,r)}let o=n.select("."+Q.popClassName.text);if(r>=Q.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,Q.popText["font-weight"],Q.popText["font-family"]),n=Q.popText["font-weight"]+" "+e+" "+Q.popText["font-family"];o.transition().duration(X.transitionTime).text(t._currentState.count).style("font",n)}else o.text("")},wt=function(t,e,r,a){let o=1.75*t;for(let t=Math.ceil(o);t>=0;t--)if(n(e,r+" "+t+"px "+a)<=o)return t+"px";return 0},kt=function(t){let n=e.select(this),r=t._currentState.radius=ft(t);n.append("circle").attr("class",Q.popClassName.circle).attr("cx",0).attr("cy",0).attr("r",r).attr("stroke",Q.popCircle.stroke).attr("stroke-width",Q.popCircle["stroke-width"]).attr("fill","none");let a=e.arc().innerRadius(0).outerRadius(r),o=vt().value(function(t){return t.value.count}),i=n.append("g").attr("class",Q.popClassName.pie);i.selectAll(Q.popClassName.slice).data(o(t._currentState.summary)).enter().append("path").attr("d",a).attr("class",Q.popClassName.slice).attr("fill",function(t){return Q.popColorScheme(t.data.key)}),i.exit().remove();let l=n.append("text").attr("class",Q.popClassName.text).attr("fill",Q.popText.fill).style("font-family",Q.popText["font-family"]).style("font-weight",Q.popText["font-weight"]).attr("text-anchor",Q.popText["text-anchor"]).attr("dy",Q.popText.dy);if(r>=Q.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,Q.popText["font-weight"],Q.popText["font-family"]);l.transition().duration(X.transitionTime).text(t._currentState.count).style("font-size",e)}else l.text("");n.on("mouseover",function(t){ht(t)}).on("mouseout",function(t){bt(t)}).on("click",function(t){xt(t,n)})},St=function(t){let n=e.select(this),r=t._currentState.radius=ft(t),a=yt(t);n.append("circle").attr("class",Q.popClassName.circle).attr("cx",0).attr("cy",0).attr("r",r).attr("stroke",Q.popCircle.stroke).attr("stroke-width",Q.popCircle["stroke-width"]).attr("fill",a.color);let o=n.append("text").attr("class",Q.popClassName.text).style("font-family",Q.popText["font-family"]).style("font-weight",Q.popText["font-weight"]).attr("text-anchor",Q.popText["text-anchor"]).attr("dy",Q.popText.dy);if(r>=Q.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,Q.popText["font-weight"],Q.popText["font-family"]);o.transition().duration(X.transitionTime).text(t._currentState.count).attr("font-size",e)}else o.text("");n.on("mouseover",function(t){ht(t)}).on("mouseout",function(t){bt(t)}).on("click",function(t){xt(t,n)})},Tt=function(){switch(x=b.append("g").attr("class",Q.lollipopClassName.group),v=x.append("g").attr("clip-path","url(#"+Q.defsId+")").selectAll(Q.lollipopClassName.line).data(K).enter().append("line").attr("x1",function(t){return pt(t)}).attr("x2",function(t){return pt(t)}).attr("y1",F(0)+J.margin.top).attr("y2",function(t){return dt(t)}).attr("class",Q.lollipopClassName.line).attr("stroke",Q.lollipopLine.stroke).attr("stroke-width",Q.lollipopLine["stroke-width"]),C=x.append("g").attr("clip-path","url(#"+Q.defsId+")").selectAll(Q.lollipopClassName.pop).data(K).enter().append("g").attr("transform",function(t){return"translate("+pt(t)+","+dt(t)+")"}).classed(Q.lollipopClassName.pop,!0).attr("id",function(t,e){return i+"-"+Y+"-lollipop-group-"+e}),a){case"pie":C.each(kt);break;default:C.each(St)}let t,e,n;Q.title.text.length>0&&("start"==Q.title.alignment?(t="start",e=0):"middle"==Q.title.alignment?(t="middle",e=$/2):(t="end",e=$),n=-X.margin.top/2,b.append("text").attr("id",Q.title.id).style("font",Q.title.font).attr("fill",Q.title.color).attr("text-anchor",t).attr("alignment-base","alphabetic").attr("transform","translate("+e+","+n+")").attr("dy",Q.title.dy).text(Q.title.text))},Lt=function(){if(e.event.sourceEvent&&"brush"===e.event.sourceEvent.type)return;let t=e.event.transform;A=t.rescaleX(R).domain(),J.brush&&y.select("."+J.className.brush).call(O.move,R.range().map(t.invertX,t)),ct()},At=function(){if(!f.hasOwnProperty("x")||!f.hasOwnProperty("y"))throw"No X or Y columns specified in data set";tt||(ot=e.nest().key(t=>t[f.factor]).rollup(function(t){return+t.length}).object(K),(K=e.nest().key(t=>+t[f.x]).entries(K).sort((t,e)=>t.key-e.key)).forEach(function(t){t.position=+t.key,delete t.key,t.total=+t.values.length})),K.forEach(function(t){let n=e.nest().key(function(t){return t[f.factor]}).rollup(function(t){let n=t.filter(function(t){return t[f.factor]in ot});return{count:+n.length,byY:e.nest().key(function(t){return t[f.y]}).rollup(function(t){return+t.length}).entries(n).sort(function(t,e){return e.value-t.value})}}).entries(t.values).sort(function(t,e){return t.key>e.key});tt||(t._currentState={},t._currentState.showLabel=!1),t._currentState.count=e.sum(n.map(function(t){return t.value.count})),t._currentState.summary=n}),tt=!0,P=K.map(function(t){return+t._currentState.count}).filter(function(t){return t>0}).sort(function(t,e){return t-e}),k=Math.ceil(e.quantile(P,Q.popParams.yLowerQuantile)),w=Math.floor(e.quantile(P,Q.popParams.yUpperQuantile)),et=[]},Dt=function(t){return e.scaleLinear().domain([0,t]).range([V,0]).nice().domain()[1]},_t=function(){(B=0==P.length?[0,1]:e.extent(P))[0]=Math.min(0,B[0]),L=B[1]=Dt(B[1]*Q.yPaddingRatio)},Et=function(){_t(),F=e.scaleLinear().domain(B).range([V,0]),M=e.axisLeft(F).tickSize(-$).ticks(9),A=[0,Z[m.length]],D=e.scaleLinear().domain(A).range([0,U]),R=e.scaleLinear().domain(A).range([0,U]),E=function(t,e){if(void 0===e||t.length<=1||t[t.length-1]>=e)return t;var n=Math.abs(t[1]-t[0]);return Math.abs(e-t[t.length-1])>n/2?t.push(e):t[t.length-1]=e,t}(D.ticks(),Z[m.length]),_=e.axisBottom(D).tickValues(E).tickFormat(function(t){return this.parentNode.nextSibling?t:t+" aa"})},Nt=function(t,e){if(1!=(e=e||1)&&-1!=e&&(e=1),t=Dt(t*Q.yPaddingRatio),t=Math.max(L,t),1===e)et.push(t),et=et.sort();else{let e=et.indexOf(t);-1!=e&&(et=et.slice(0,e).concat(et.slice(e+1)))}let n=0==et.length?L:et[et.length-1];n!=B[1]&&(B[1]=n,Bt())},Bt=function(){F.domain(B),z.transition().duration(X.transitionTime).call(Ft),v.transition().duration(X.transitionTime).attr("y2",function(t){return dt(t)}),C.transition().duration(X.transitionTime).attr("transform",function(t){return"translate("+pt(t)+","+dt(t)+")"})},Ft=function(t){var e=t.selection?t.selection():t;t.call(M),e.select(".domain").remove(),e.selectAll(".tick line").filter(Number).attr("stroke","#aaa").attr("stroke-dasharray","2,2"),e.selectAll(".tick text").attr("x",-2).attr("dy",2),e!==t&&t.selectAll(".tick text").attrTween("x",null).attrTween("dy",null)},Mt=function(t,e,n,r){t.append("g").attr("id","background-layer").append("rect").attr("x",0).attr("y",0).attr("width",r).attr("height",n).attr("fill",e)},Pt=function(){t||(t="g3_"+Y,e.select("body").append("div").attr("id",t)),(g=e.select("#"+t).append("svg")).attr("width",G).attr("height",q).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink"),g.classed(X.className,!0).attr("id",X.chartID).style("background-color",X.background||"transparent"),h=g.append("g").attr("transform","translate("+X.margin.left+","+X.margin.top+")"),b=h.append("g").attr("id",Q.id),Mt(b,Q.background,V,$),y=h.append("g").attr("id",J.id).attr("transform","translate(0, "+(V+J.margin.top)+")"),Mt(y,J.background,j,U),X.tooltip&&(nt=u().attr("class","d3-tip").offset([8,0]).direction(function(t){return t.count>B[1]/2?"s":"n"}).offset(function(t){return t.count>B[1]/2?[16,0]:[-12,0]}).html(mt),b.call(nt))},zt={};return zt.options={set chartTarget(e){t=e},get chartTarget(){return t},set chartWidth(t){o=t},get chartWidth(){return o},set chartType(t){t&&t in s&&(a=t)},get chartType(){return a},get chartID(){return X.chartID},get chartHeight(){return+g.attr("height")},set chartMargin(t){X.margin=t},get chartMargin(){return X.margin},set chartBackground(t){X.background=t},get charBackground(){return X.background},set transitionTime(t){X.transitionTime=t},get transitionTime(){return X.transitionTime},set tooltip(t){X.tooltip=t},get tooltip(){return X.tooltip},set yAxisLabel(t){Q.ylab.text=t},get yAxisLabel(){return Q.ylab.text},set axisLabelFont(t){Q.axisLabel.font=t},get axisLabelFont(){return Q.axisLabel.font},set axisLabelColor(t){Q.axisLabel.fill=t},get axisLabelColor(){return Q.axisLabel.fill},set axisLabelAlignment(t){Q.axisLabel.alignment=t},get axisLabelAlignment(){return Q.axisLabel.alignment},set axisLabelDy(t){Q.axisLabel.dy=t},get axisLabelDy(){return Q.axisLabel.dy},set legend(t){X.legend=t},get legend(){return X.legend},set legendMargin(t){X.legendOpt.margin=t},get legendMargin(){return X.legendOpt.margin},set legendInteractive(t){X.legendOpt.interactive=t},get legendInteractive(){return X.legendOpt.interactive},set legendTitle(t){X.legendOpt.title=t},get legendTitle(){return X.legendOpt.title},get legendHeight(){return W},get lollipopTrackID(){return Q.id},set lollipopTrackHeight(t){Q.height=t},get lollipopTrackHeight(){return Q.height},set lollipopTrackBackground(t){Q.background=t},get lollipopTrackBackground(){return Q.background},set lollipopPopMinSize(t){Q.popParams.rMin=t},get lollipopPopMinSize(){return Q.popParams.rMin},set lollipopPopMaxSize(t){Q.popParams.rMax=t},get lollipopPopMaxSize(){return Q.popParams.rMax},set lollipopPopInfoLimit(t){Q.popParams.addNumRCutoff=t},get lollipopPopInfoLimit(){return Q.popParams.addNumRCutoff},set lollipopPopInfoColor(t){Q.popText.fill=t},get lollipopPopInfoColor(){return Q.popText.fill},set lollipopLineColor(t){Q.lollipopLine.stroke=t},get lollipopLineColor(){return Q.lollipopLine.stroke},set lollipopLineWidth(t){Q.lollipopLine["stroke-width"]=t},get lollipopLineWidth(){return Q.lollipopLine["stroke-width"]},set lollipopCircleColor(t){Q.popCircle.stroke=t},get lollipopCircleColor(){return Q.popCircle.stroke},set lollipopCircleWidth(t){Q.popCircle["stroke-width"]=t},get lollipopCircleWidth(){return Q.popCircle["stroke-width"]},set lollipopLabelRatio(t){Q.popLabel.fontsizeToRadius=t},get lollipopLabelRatio(){return Q.popLabel.fontsizeToRadius},set lollipopLabelMinFontSize(t){Q.popLabel.minFontSize=t},get lollipopLabelMinFontSize(){return Q.popLabel.minFontSize},set lollipopColorScheme(t){Q.popColorSchemeName=t,zt.popColorScheme=l(t)},get lollipopColorScheme(){return Q.popColorSchemeName},set titleText(t){Q.title.text=t},get titleText(){return Q.title.text},set titleFont(t){Q.title.font=t},get titleFont(){return Q.title.font},set titleColor(t){Q.title.color=t},get titleColor(){return Q.title.color},set titleAlignment(t){Q.title.alignment=t},get titleAlignment(){return Q.title.alignment},set titleDy(t){Q.title.dy=t},get titleY(){return Q.title.dy},get annoID(){return J.id},set annoHeight(t){J.height=t},get annoHeight(){return J.height},set annoMargin(t){J.margin=t},get annoMargin(){return J.margin},set annoBackground(t){J.background=t},get annoBackground(){return J.background},set annoBarFill(t){J.bar.background=t},get annoBarFill(){return J.bar.background},set annoBarMargin(t){J.bar.margin=t},get annoBarMargin(){return J.bar.margin},set domainColorScheme(t){J.domain.colorSchemeName=t,J.domain.colorScheme=l(t)},get domainColorScheme(){return J.domain.colorSchemeName},set domainMargin(t){J.domain.margin=t},get domainMargin(){return J.domain.margin},set domainTextFont(t){J.domain.label.font=t},get domainTextFont(){return J.domain.label.font},set domainTextColor(t){J.domain.label.color=t},get domainTextColor(){return J.domain.label.color},set brush(t){J.brush=t},get brush(){return J.brush},set zoom(t){J.zoom=t},get zoom(){return J.zoom}},zt.setOptions=function(t){for(let e in t)this.options[e]=t[e]},zt.getOptions=function(t){let e={},n=this;return t.forEach(function(t){n.options[t]&&(e[t]=n.options[t])}),e},zt.destroy=function(){g.selectAll("*").remove(),g.remove(),X.tooltip&&rt&&nt.destroy()},zt.refresh=function(){this.destroy(),this.draw()},zt.data={set snvData(t){K=t},get snvData(){return K},set domainData(t){Z=t},get domainData(){return Z}},zt.format={set snvData(t){f=t},get snvData(){return f},set domainData(t){m=t},get domainData(){return m}},zt.draw=function(){m=m||d,(f=f||p).hasOwnProperty("factor")?at=!0:(at=!1,zt.format.snvData.factor=f.factor="__undefined__",K.forEach(function(t){t[f.factor]="__undefined__"})),q=Q.height+J.height,G=o,V=Q.height-X.margin.top-X.margin.bottom,$=G-X.margin.left-X.margin.right,j=J.height-J.margin.top-J.margin.bottom,U=$,At(),Pt(),function(){let t,e;Et(),z=b.append("g").attr("class","axis axis--y").call(Ft),"start"==Q.axisLabel.alignment?(t="end",e=0):"middle"==Q.axisLabel.alignment?(t="middle",e=V/2):(t="start",e=V),b.append("text").attr("class","yaxis axis-label").attr("transform","translate(0,"+e+")rotate(-90)").style("font",Q.axisLabel.font).attr("fill",Q.axisLabel.fill).attr("text-anchor",t).attr("alignment-base","middle").attr("dy",Q.axisLabel.dy).text(Q.ylab.text),N=b.append("g").attr("clip-path","url(#"+Q.xAxisDefsId+")").attr("class","axis axis--x").attr("transform","translate(0, "+(V+J.height)+")").call(_)}(),b.append("clipPath").attr("id",Q.defsId).append("rect").attr("width",$).attr("height",V+J.margin.top),b.append("clipPath").attr("id",Q.xAxisDefsId).append("rect").attr("x",-5).attr("width",$+20).attr("height",30),y.append("clipPath").attr("id",J.defsId).append("rect").attr("width",U).attr("height",j),function(){let t=j-J.bar.margin.top-J.bar.margin.bottom;y.append("rect").classed(J.className.bar,!0).attr("x",0).attr("y",J.bar.margin.top).attr("width",U).attr("height",t).attr("fill",J.bar.background);let n=j-J.domain.margin.top-J.domain.margin.bottom,r=y.append("g").attr("class",J.className.track).selectAll(J.className.domain).data(Z[m.domainType]).enter().append("g").attr("clip-path","url(#"+J.defsId+")").attr("class",J.className.domain);S=r.append("rect").attr("x",function(t){return lt(t)}).attr("y",J.domain.margin.top).attr("height",n).attr("width",function(t){return it(t)}).attr("fill",function(t){return J.domain.colorScheme(t[m.details.name])}),T=r.append("text").attr("x",function(t){return(lt(t)+st(t))/2}).attr("y",J.domain.margin.top+n/2).attr("dy","0.35em").attr("text-anchor","middle").attr("fill",J.domain.label.color||"white").style("font",J.domain.label.font).text(function(t){return t[m.details.name]}),J.brush&&(O=e.brushX().extent([[0,0],[U,j]]).on("brush end",ut)),J.zoom&&(H=e.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[$,V]]).extent([[0,0],[$,V]]).on("zoom",Lt)),J.brush&&y.append("g").attr("class",J.className.brush).call(O),J.zoom&&b.append("rect").attr("class",J.className.zoom).attr("width",$).attr("height",V).attr("fill","none").attr("cursor","move").attr("pointer-events","all").call(H)}(),Tt(),X.legend&&function(){if(X.legend){I=new c(X.chartID),0==Object.keys(X.legendOpt.margin).length&&(X.legendOpt.margin={left:X.margin.left,right:X.margin.right,top:2,bottom:2}),I.margin=X.legendOpt.margin,I.interactive=X.legendOpt.interactive,I.title="__undefined__"===X.legendOpt.title?f.factor:X.legendOpt.title;for(let t in ot)I.addSeries({key:t,value:{fill:Q.popColorScheme(t),label:t+" ("+ot[t]+")"}});I.dispatch.on("legendClick",function(t,e){e?ot[t]=e:delete ot[t],At(),_t(),Bt(),C.each(Ct)}),I.draw(),W=I.height}}(),J.brush&&y.select(".domain-x-brush").call(O.move,[0,U]),rt=!0},zt},Object.defineProperty(t,"__esModule",{value:!0})});